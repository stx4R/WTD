<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WTD - What To Do</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --main-blue: #3182f6;      /* 토스 대표 블루 */
            --bg-blue: #f2f7ff;        /* 밝은 파스텔톤 파란색 배경 */
            --gray-text: #8b95a1;      /* 부제목용 회백색 */
            --dark-gray: #4e5968;      /* 안내 문구용 어두운 회색 */
            --black: #191f28;          /* 기본 텍스트 검정 */
        }

        * { box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow-x: hidden; color: var(--black); }

        /* 공통 애니메이션 */
        .up-fade-in { animation: upFadeIn 0.8s forwards; }
        .up-fade-out { animation: upFadeOut 0.8s forwards; }

        @keyframes upFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes upFadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        /* 로고 스타일 */
        .logo-container { position: absolute; top: 20px; left: 20px; z-index: 100; cursor: pointer; }
        .logo-img { width: 80px; }

        /* 섹션 제어 */
        section { display: none; width: 100%; min-height: 100vh; position: relative; padding: 20px; }
        section.active { display: flex; flex-direction: column; align-items: center; justify-content: center; }

        /* 1. 랜딩 페이지 */
        #landing-page { cursor: pointer; background-color: white; }
        #landing-page .logo-main { width: 150px; margin-bottom: 20px; }
        .guide-text { color: var(--dark-gray); font-size: 1.1rem; position: absolute; bottom: 45%; }
        .manage-text { color: var(--black); font-weight: bold; font-size: 1.5rem; opacity: 0; }
        .login-trigger-btn { margin-top: 30px; background: var(--main-blue); color: white; border: none; padding: 15px 40px; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; display: none; }

        /* 2. 로그인 페이지 */
        .login-card { width: 100%; max-width: 400px; text-align: left; }
        .login-card h1 { font-size: 1.8rem; margin-bottom: 30px; }
        .input-group { margin-bottom: 15px; }
        .input-group input { width: 100%; padding: 16px; border-radius: 12px; border: 1px solid #e5e8eb; background: #f9fafb; font-size: 1rem; outline: none; }
        .input-group input:focus { border-color: var(--main-blue); }
        .btn-login { width: 100%; background: var(--main-blue); color: white; border: none; padding: 16px; border-radius: 12px; font-size: 1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* 3. 메인 대시보드 */
        #main-dashboard { background-color: #f9fafb; justify-content: flex-start; padding-top: 80px; }
        .user-header { width: 100%; max-width: 500px; margin-bottom: 30px; }
        .user-header h1 { margin: 0; font-size: 1.7rem; }
        .user-header p { color: var(--gray-text); margin-top: 5px; font-size: 1.1rem; }

        .card { width: 100%; max-width: 500px; background: white; border-radius: 24px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        .card h3 { margin-top: 0; font-size: 1.1rem; color: var(--dark-gray); margin-bottom: 15px; }

        /* 일정 리스트 스타일 */
        .todo-item { display: flex; align-items: center; padding: 15px 0; border-bottom: 1px solid #f2f4f6; }
        .todo-item:last-child { border-bottom: none; }
        .check-box { width: 24px; height: 24px; border: 2px solid var(--main-blue); border-radius: 6px; cursor: pointer; margin-right: 15px; }
        .todo-text { flex-grow: 1; font-size: 1.05rem; }
        .time-badge { font-size: 0.8rem; color: var(--main-blue); background: var(--bg-blue); padding: 4px 8px; border-radius: 6px; }

        /* 입력 폼 */
        .add-form { display: flex; gap: 10px; }
        .add-form input { flex-grow: 1; border: none; background: #f2f4f6; padding: 12px; border-radius: 10px; outline: none; }
        .add-btn { background: var(--main-blue); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* 팝업 창 */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index:1000; }
        .modal { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; }
    </style>
</head>
<body>

    <div class="logo-container" onclick="location.reload()">
        <img src="static/WTDlogo.png" alt="WTD" class="logo-img" onerror="this.src='https://via.placeholder.com/80x30?text=WTD'">
    </div>

    <section id="landing-page" class="active" onclick="handleLandingClick()">
        <img src="static/WTDlogo.png" alt="WTD" class="logo-main" onerror="this.style.display='none'">
        <div id="guide-text" class="guide-text">화면의 아무곳을 탭하세요.</div>
        <div id="manage-text" class="manage-text">당신의 일정을 관리하세요.</div>
        <button id="login-trigger" class="login-trigger-btn" onclick="goToLogin(event)">로그인하기</button>
    </section>

    <section id="login-page">
        <div class="login-card">
            <h1>WTD에 로그인하세요.</h1>
            <div class="input-group">
                <input type="email" id="email-input" placeholder="학교 이메일 (@dshs.kr)">
            </div>
            <div class="input-group">
                <input type="password" placeholder="비밀번호">
            </div>
            <button class="btn-login" onclick="checkLogin()">로그인하기</button>
        </div>
    </section>

    <div id="name-modal" class="modal-overlay">
        <div class="modal">
            <h3>사용하실 이름을 입력해주세요</h3>
            <input type="text" id="nickname-input" style="width:100%; padding:12px; margin:20px 0; border:1px solid #ddd; border-radius:10px;">
            <button class="btn-login" onclick="finishSetup()">시작하기</button>
        </div>
    </div>

    <section id="main-dashboard">
        <div class="user-header">
            <h1 id="user-welcome">님 환영합니다.</h1>
            <p id="user-subtitle">님의 일정을 관리하세요.</p>
        </div>

        <div class="card">
            <h3>⏳ 타임라인 (D-Day)</h3>
            <div id="timeline-area">일정을 추가하면 남은 시간이 표시됩니다.</div>
        </div>

        <div class="card">
            <h3>✅ 현재 남은 일정</h3>
            <div id="todo-list-area"></div>
        </div>

        <div class="card">
            <h3>➕ 일정 추가하기</h3>
            <div class="add-form">
                <input type="text" id="new-todo" placeholder="무엇을 해야 하나요?">
                <button class="add-btn" onclick="addNewTodo()">추가</button>
            </div>
        </div>
    </section>

    <script>
        let landingStep = 0;
let userName = "";
let currentUserEmail = ""; // 현재 로그인한 이메일 저장
let todos = [];

// 1. 랜딩 페이지 애니메이션 (기존과 동일)
function handleLandingClick() {
    const guide = document.getElementById('guide-text');
    const manage = document.getElementById('manage-text');
    const btn = document.getElementById('login-trigger');

    if (landingStep === 0) {
        guide.classList.add('up-fade-out');
        setTimeout(() => {
            guide.style.display = 'none';
            manage.classList.add('up-fade-in');
            manage.style.opacity = '1';
        }, 400);
        landingStep = 1;
    } else if (landingStep === 1) {
        btn.style.display = 'block';
        btn.classList.add('up-fade-in');
        landingStep = 2;
    }
}

function goToLogin(e) {
    e.stopPropagation();
    document.getElementById('landing-page').classList.remove('active');
    document.getElementById('login-page').classList.add('active');
}

// 2. 로그인 확인 및 데이터 불러오기
function checkLogin() {
    const email = document.getElementById('email-input').value;
    if (email.endsWith('@dshs.kr')) {
        currentUserEmail = email;
        
        // 로컬 스토리지에서 이 이메일로 저장된 이름이 있는지 확인
        const savedName = localStorage.getItem(`name_${email}`);
        
        if (savedName) {
            // 이미 정보가 있는 사용자는 바로 대시보드로
            userName = savedName;
            loadUserData();
            showDashboard();
        } else {
            // 처음 접속하는 사용자는 닉네임 팝업 노출
            document.getElementById('name-modal').style.display = 'flex';
        }
    } else {
        alert('아이디는 @dshs.kr로 끝나는 이메일이어야 합니다.');
    }
}

// 3. 이름 설정 및 저장
function finishSetup() {
    userName = document.getElementById('nickname-input').value;
    if (!userName) return alert('이름을 입력해주세요!');
    
    // 이름 저장
    localStorage.setItem(`name_${currentUserEmail}`, userName);
    
    document.getElementById('name-modal').style.display = 'none';
    loadUserData();
    showDashboard();
}

// 4. 대시보드 표시 전환
function showDashboard() {
    document.getElementById('login-page').classList.remove('active');
    document.getElementById('main-dashboard').classList.add('active');
    document.getElementById('user-welcome').innerText = `${userName}님 환영합니다.`;
    document.getElementById('user-subtitle').innerText = `${userName}님의 일정을 관리하세요.`;
}

// 5. 사용자별 일정 데이터 로드/저장
function loadUserData() {
    const savedTodos = localStorage.getItem(`todos_${currentUserEmail}`);
    todos = savedTodos ? JSON.parse(savedTodos) : [];
    renderTodos();
}

function saveUserData() {
    localStorage.setItem(`todos_${currentUserEmail}`, JSON.stringify(todos));
}

// 6. 일정 추가/삭제 (기존 로직에 저장 기능 추가)
function addNewTodo() {
    const input = document.getElementById('new-todo');
    if (!input.value) return;

    const todo = {
        id: Date.now(),
        text: input.value,
        time: "D-Day"
    };

    todos.push(todo);
    input.value = "";
    saveUserData(); // 데이터 저장
    renderTodos();
}

function removeTodo(id) {
    // 체크박스 클릭 시 사라지는 효과
    todos = todos.filter(t => t.id !== id);
    saveUserData(); // 데이터 저장
    renderTodos();
}

function renderTodos() {
    const listArea = document.getElementById('todo-list-area');
    const timelineArea = document.getElementById('timeline-area');
    
    listArea.innerHTML = "";
    timelineArea.innerHTML = "";

    if (todos.length === 0) {
        listArea.innerHTML = "남은 일정이 없습니다.";
        timelineArea.innerHTML = "일정을 추가하면 남은 시간이 표시됩니다.";
        return;
    }

    todos.forEach(todo => {
        const item = document.createElement('div');
        item.className = 'todo-item up-fade-in';
        item.innerHTML = `
            <div class="check-box" onclick="removeTodo(${todo.id})"></div>
            <div class="todo-text">${todo.text}</div>
            <div class="time-badge">${todo.time}</div>
        `;
        listArea.appendChild(item);

        const timeItem = document.createElement('div');
        timeItem.style.marginBottom = "10px";
        timeItem.innerHTML = `<strong>${todo.text}</strong>: <span style="color:var(--main-blue)">진행 중</span>`;
        timelineArea.appendChild(timeItem);
    });
}
    </script>

</body>
</html>
